<!DOCTYPE html>
<html>
<head>
  <title>ABSEN QR SMKN1-PASURUAN</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body {
    margin: 0;
    background-color: black;
    color: white;
    font-family: sans-serif;
    text-align: center;
  }

  h1 {
    margin-top: 10px;
    font-size: 6vw; /* Ukuran dinamis */
  }

  p {
    margin-top: -10px;
    font-size: 3.5vw;
    color: #ccc;
  }

  #scanner {
    width: 90vw; /* Hampir penuh tapi masih ada margin */
    max-width: 400px;
    margin: auto;
    padding: 10px;
  }

  #status {
    margin-top: 10px;
    font-size: 5vw;
    font-weight: bold;
    color: white;
  }

  @media (min-width: 768px) {
    h1 { font-size: 24px; }
    p { font-size: 16px; }
    #status { font-size: 20px; }
  }
</style>

</head>
<body>
  <h1>ABSEN QR SMKN1-PASURUAN</h1>
  <p>Arahkan kartu QR ke kamera</p>
  <div id="scanner"></div>
  <div id="status">Menunggu scan...</div>
  <audio id="beep" src="https://www.soundjay.com/buttons/sounds/beep-07.mp3"></audio>

  <script>
    const statusEl = document.getElementById("status");
    const beep = document.getElementById("beep");
    const urlAPI = "https://script.google.com/macros/s/AKfycbwVUv1ij8NQFbkrMWv3yS3kFelqkthuQwkagUkdgDE2y-Cjl9rnP5pvWC7OToOtZPd3/exec"; // Ganti dengan punyamu

    let scanner;

    function showStatus(msg, color = "white") {
      statusEl.textContent = msg;
      statusEl.style.color = color;
    }

    function startScanner() {
      scanner = new Html5Qrcode("scanner");

      scanner.start(
        { facingMode: "environment" }, // ganti ke "user" kalau kamera depan
        {
          fps: 10,
          qrbox: 250
        },
        qrCodeMessage => {
          scanner.stop().then(() => {
            showStatus("Memproses...", "yellow");

            fetch(urlAPI + "?token=" + encodeURIComponent(qrCodeMessage))
              .then(res => res.json())
              .then(data => {
                if (data.status === "success") {
                  beep.play();
                  showStatus("ABSEN BERHASIL ✅ " + data.nama, "lime");
                } else {
                  showStatus("❌ " + data.pesan, "red");
                }

                setTimeout(() => {
                  showStatus("Menunggu scan...");
                  startScanner(); // mulai lagi
                }, 1500);
              })
              .catch(err => {
                showStatus("⚠️ Gagal terhubung.", "orange");
                setTimeout(() => {
                  showStatus("Menunggu scan...");
                  startScanner(); // mulai lagi
                }, 1500);
              });
          });
        },
        error => {} // kita cuekin error scan per frame
      );
    }

    startScanner();
  </script>
</body>
</html>
